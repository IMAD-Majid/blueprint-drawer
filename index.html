<!DOCTYPE html>
<html>

<head>
    <title>Blueprint</title>
    <style>
        body {
            background-color: slategray;
            color: white;
            width: fit-content;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin: 0;
        }
    </style>
</head>

<body>
    <h1>MAP</h1>
    <canvas width="1200px" height="512px"></canvas>
    <div>
        <select id="map">
        </select>
        <button onclick="saveMap()">Save Path</button>
        <button onclick="startSearch()">Path Find</button>
        <div>
            <label>
                <input type="radio" name="selected-spr" checked>
                Start
            </label>
            <label>
                <input type="radio" name="selected-spr">
                End
            </label>
            <label>
                <input type="radio" name="selected-spr">
                Wall
            </label>
            <label>
                <input type="radio" name="selected-spr">
                Door
            </label>
            <label>
                <input type="radio" name="selected-spr">
                Stair
            </label>
        </div>
        <div>
            <input type="number" placeholder="Shift X" id="shiftx">
            <input type="number" placeholder="Shift Y" id="shifty">
            <button onclick="mapShift()">Shift</button>
        </div>
        <p></p>
    </div>
    <script>
        const canvas = document.querySelector("canvas");
        const ctx = canvas.getContext("2d");

        const cell = 32;
        const xmax = canvas.offsetWidth / cell;
        const ymax = canvas.offsetHeight / cell;
        const fps = 20;


        let savedmaps = {"000:0":{"start":[17,13],"end":[17,7],"walls":[[14,7,15,7],[15,7,16,7],[16,7,17,7],[13,7,14,7],[12,7,13,7],[12,5,13,5],[13,5,14,5],[14,5,15,5],[15,5,16,5],[16,5,17,5],[17,5,18,5],[19,5,20,5],[20,5,21,5],[21,5,22,5],[20,7,21,7],[19,7,20,7],[21,7,22,7],[24,5,24,6],[23,5,24,5],[22,5,23,5],[22,7,23,7],[23,7,24,7],[24,6,24,7],[11,5,12,5],[11,5,11,6],[11,7,12,7],[11,6,11,7],[22,2,22,3],[28,5,29,5],[28,8,29,8],[28,7,28,8],[28,6,28,7],[29,8,30,8],[30,7,30,8],[30,6,30,7],[30,5,30,6],[29,5,30,5],[28,8,28,9],[30,9,30,10],[30,8,30,9],[28,10,28,11],[30,10,30,11],[30,11,30,12],[28,3,28,4],[30,3,30,4],[30,4,30,5],[28,11,29,11],[29,11,30,11],[28,12,28,13],[28,13,29,13],[29,13,30,13],[30,12,30,13],[28,3,29,3],[29,3,30,3],[18,5,19,5],[15,4,16,4],[16,4,17,4],[17,4,18,4],[18,4,19,4],[19,4,20,4],[20,4,21,4],[21,4,22,4],[22,3,22,4],[15,2,16,2],[16,2,17,2],[17,2,18,2],[18,2,19,2],[19,2,20,2],[20,2,21,2],[21,2,22,2],[16,15,17,15],[15,15,16,15],[14,15,15,15],[13,15,14,15],[12,15,13,15],[11,15,12,15],[10,15,11,15],[9,15,10,15],[8,15,9,15],[7,15,8,15],[6,15,7,15],[19,15,20,15],[20,15,21,15],[21,15,22,15],[22,15,23,15],[23,15,24,15],[24,15,25,15],[25,15,26,15],[26,15,27,15],[27,15,28,15],[28,15,29,15],[29,15,30,15],[30,14,30,15],[30,13,30,14],[30,2,30,3],[30,1,30,2],[29,1,30,1],[28,1,29,1],[27,1,28,1],[26,1,27,1],[24,1,25,1],[25,1,26,1],[23,1,24,1],[22,1,23,1],[21,1,22,1],[20,1,21,1],[19,1,20,1],[18,1,19,1],[17,1,18,1],[16,1,17,1],[15,1,16,1],[14,1,15,1],[13,1,14,1],[12,1,13,1],[11,1,12,1],[10,1,11,1],[9,1,10,1],[8,1,9,1],[7,1,8,1],[6,1,7,1],[6,1,6,2],[6,4,6,5],[6,6,6,7],[6,5,6,6],[6,7,6,8],[6,8,6,9],[6,9,6,10],[6,10,6,11],[6,11,6,12],[6,12,6,13],[6,13,6,14],[6,14,6,15]],"doors":[[17,7,18,7,1,1],[18,7,19,7,0,0],[28,5,28,6,1,1],[28,4,28,5,1,1],[28,9,28,10,1,1],[28,11,28,12,1,1],[15,2,15,3,1,1],[15,3,15,4,0,0],[17,15,18,15,1,1],[18,15,19,15,0,0],[6,3,6,4,0,0],[6,2,6,3,1,1]],"stairs":[]},"000:1":{"start":[17,12],"end":[14,10],"walls":[[16,11,17,11],[19,11,20,11],[19,10,19,11],[20,10,21,10],[19,10,20,10],[21,11,22,11],[21,10,22,10],[20,11,21,11],[22,10,22,11],[24,11,25,11],[16,10,16,11],[16,9,16,10],[15,9,16,9],[14,10,14,11],[14,9,14,10],[12,9,13,9],[12,9,12,10],[12,10,12,11],[12,11,13,11],[13,11,14,11],[14,11,15,11],[15,11,16,11],[11,9,12,9],[10,9,10,10],[10,10,10,11],[11,11,12,11],[10,11,11,11],[9,9,10,9],[9,11,10,11],[8,11,9,11],[7,11,8,11],[8,10,8,11],[8,9,8,10],[6,9,6,10],[6,11,7,11],[5,11,6,11],[3,11,4,11],[6,10,6,11],[3,9,4,9],[4,9,5,9],[4,9,4,10],[4,11,5,11],[2,11,3,11],[2,10,2,11],[2,9,3,9],[2,9,2,10],[5,7,5,8],[15,8,16,8],[14,8,15,8],[13,7,13,8],[13,6,13,7],[13,6,14,6],[14,6,15,6],[15,6,16,6],[16,6,16,7],[16,7,16,8],[12,8,13,8],[11,7,11,8],[11,6,11,7],[11,6,12,6],[12,6,13,6],[10,6,11,6],[9,6,10,6],[8,6,9,6],[7,6,8,6],[5,6,6,6],[6,6,7,6],[5,6,5,7],[10,8,11,8],[8,8,9,8],[9,7,9,8],[9,6,9,7],[6,8,7,8],[7,7,7,8],[7,6,7,7],[4,6,5,6],[2,6,3,6],[3,6,4,6],[2,6,2,7],[2,7,2,8],[2,8,2,9],[6,9,7,9],[16,6,17,6],[18,6,19,6],[17,6,18,6],[19,6,20,6],[21,6,22,6],[20,6,21,6],[22,6,23,6],[23,6,24,6],[25,6,26,6],[24,6,25,6],[26,6,27,6],[27,6,28,6],[28,6,29,6],[29,6,30,6],[30,6,31,6],[31,6,32,6],[32,6,33,6],[33,6,34,6],[18,6,18,7],[18,7,18,8],[19,8,20,8],[22,8,23,8],[21,6,21,7],[21,7,22,7],[20,7,21,7],[19,7,20,7],[18,7,19,7],[25,10,25,11],[25,9,25,10],[23,7,23,8],[23,6,23,7],[22,7,23,7],[20,8,21,8],[25,6,25,7],[25,7,25,8],[25,8,26,8],[27,7,27,8],[27,6,27,7],[25,9,26,9],[25,11,26,11],[26,11,27,11],[27,10,27,11],[27,9,28,9],[27,9,27,10],[27,11,28,11],[28,11,29,11],[29,10,29,11],[29,9,29,10],[29,11,30,11],[30,11,31,11],[31,10,31,11],[31,9,31,10],[29,9,30,9],[31,11,32,11],[32,11,33,11],[33,10,33,11],[33,9,33,10],[31,9,32,9],[33,11,34,11],[34,11,35,11],[33,9,34,9],[35,10,35,11],[35,9,35,10],[35,8,35,9],[34,6,35,6],[35,7,35,8],[35,6,35,7],[27,8,28,8],[29,8,30,8],[29,7,29,8],[29,6,29,7],[31,7,31,8],[31,6,31,7],[31,8,32,8],[33,7,33,8],[33,6,33,7],[33,8,34,8]],"doors":[[17,11,18,11,1,1],[18,11,19,11,0,0],[22,11,23,11,1,1],[23,11,24,11,0,0],[14,9,15,9,1,0],[13,8,14,8,0,0],[11,8,12,8,0,0],[9,8,10,8,0,0],[7,8,8,8,0,0],[5,8,6,8,0,0],[5,8,5,9,1,0],[5,9,6,9,0,1],[4,10,4,11,0,1],[7,9,8,9,0,1],[8,9,9,9,1,0],[13,9,14,9,0,1],[10,9,11,9,1,0],[18,8,19,8,1,1],[21,8,22,8,1,1],[26,8,27,8,1,1],[28,8,29,8,1,1],[30,8,31,8,1,1],[32,8,33,8,1,1],[34,8,35,8,1,1],[34,9,35,9,0,1],[32,9,33,9,0,1],[30,9,31,9,0,1],[28,9,29,9,0,1],[26,9,27,9,0,1]],"stairs":[[16,7],[16,6],[17,6],[24,7],[24,6],[23,6]]},"3:1":{"start":[17,12],"end":[14,10],"walls":[[16,11,17,11],[19,11,20,11],[19,10,19,11],[20,10,21,10],[19,10,20,10],[21,11,22,11],[21,10,22,10],[20,11,21,11],[22,10,22,11],[24,11,25,11],[16,10,16,11],[16,9,16,10],[15,9,16,9],[14,10,14,11],[14,9,14,10],[12,9,13,9],[12,9,12,10],[12,10,12,11],[12,11,13,11],[13,11,14,11],[14,11,15,11],[15,11,16,11],[11,9,12,9],[10,9,10,10],[10,10,10,11],[11,11,12,11],[10,11,11,11],[9,9,10,9],[9,11,10,11],[8,11,9,11],[7,11,8,11],[8,10,8,11],[8,9,8,10],[6,9,6,10],[6,11,7,11],[5,11,6,11],[3,11,4,11],[6,10,6,11],[3,9,4,9],[4,9,5,9],[4,9,4,10],[4,11,5,11],[2,11,3,11],[2,10,2,11],[2,9,3,9],[2,9,2,10],[5,7,5,8],[15,8,16,8],[14,8,15,8],[13,7,13,8],[13,6,13,7],[13,6,14,6],[14,6,15,6],[15,6,16,6],[16,6,16,7],[16,7,16,8],[12,8,13,8],[11,7,11,8],[11,6,11,7],[11,6,12,6],[12,6,13,6],[10,6,11,6],[9,6,10,6],[8,6,9,6],[7,6,8,6],[5,6,6,6],[6,6,7,6],[5,6,5,7],[10,8,11,8],[8,8,9,8],[9,7,9,8],[9,6,9,7],[6,8,7,8],[7,7,7,8],[7,6,7,7],[4,6,5,6],[2,6,3,6],[3,6,4,6],[2,6,2,7],[2,7,2,8],[2,8,2,9],[6,9,7,9],[16,6,17,6],[18,6,19,6],[17,6,18,6],[19,6,20,6],[21,6,22,6],[20,6,21,6],[22,6,23,6],[23,6,24,6],[25,6,26,6],[24,6,25,6],[26,6,27,6],[27,6,28,6],[28,6,29,6],[29,6,30,6],[30,6,31,6],[31,6,32,6],[32,6,33,6],[33,6,34,6],[18,6,18,7],[18,7,18,8],[19,8,20,8],[22,8,23,8],[21,6,21,7],[21,7,22,7],[20,7,21,7],[19,7,20,7],[18,7,19,7],[25,10,25,11],[25,9,25,10],[23,7,23,8],[23,6,23,7],[22,7,23,7],[20,8,21,8],[25,6,25,7],[25,7,25,8],[25,8,26,8],[27,7,27,8],[27,6,27,7],[25,9,26,9],[25,11,26,11],[26,11,27,11],[27,10,27,11],[27,9,28,9],[27,9,27,10],[27,11,28,11],[28,11,29,11],[29,10,29,11],[29,9,29,10],[29,11,30,11],[30,11,31,11],[31,10,31,11],[31,9,31,10],[29,9,30,9],[31,11,32,11],[32,11,33,11],[33,10,33,11],[33,9,33,10],[31,9,32,9],[33,11,34,11],[34,11,35,11],[33,9,34,9],[35,10,35,11],[35,9,35,10],[35,8,35,9],[34,6,35,6],[35,7,35,8],[35,6,35,7],[27,8,28,8],[29,8,30,8],[29,7,29,8],[29,6,29,7],[31,7,31,8],[31,6,31,7],[31,8,32,8],[33,7,33,8],[33,6,33,7],[33,8,34,8]],"doors":[[17,11,18,11,1,1],[18,11,19,11,0,0],[22,11,23,11,1,1],[23,11,24,11,0,0],[14,9,15,9,1,0],[13,8,14,8,0,0],[11,8,12,8,0,0],[9,8,10,8,0,0],[7,8,8,8,0,0],[5,8,6,8,0,0],[5,8,5,9,1,0],[5,9,6,9,0,1],[4,10,4,11,0,1],[7,9,8,9,0,1],[8,9,9,9,1,0],[13,9,14,9,0,1],[10,9,11,9,1,0],[18,8,19,8,1,1],[21,8,22,8,1,1],[26,8,27,8,1,1],[28,8,29,8,1,1],[30,8,31,8,1,1],[32,8,33,8,1,1],[34,8,35,8,1,1],[34,9,35,9,0,1],[32,9,33,9,0,1],[30,9,31,9,0,1],[28,9,29,9,0,1],[26,9,27,9,0,1]],"stairs":[[16,7],[16,6],[17,6],[24,7],[24,6],[23,6]]},"3:0":{"start":[15,13],"end":[15,7],"walls":[[12,7,13,7],[13,7,14,7],[14,7,15,7],[11,7,12,7],[10,7,11,7],[10,5,11,5],[11,5,12,5],[12,5,13,5],[13,5,14,5],[14,5,15,5],[15,5,16,5],[17,5,18,5],[18,5,19,5],[19,5,20,5],[18,7,19,7],[17,7,18,7],[19,7,20,7],[22,5,22,6],[21,5,22,5],[20,5,21,5],[20,7,21,7],[21,7,22,7],[22,6,22,7],[9,5,10,5],[9,5,9,6],[9,7,10,7],[9,6,9,7],[20,2,20,3],[26,5,27,5],[26,8,27,8],[26,7,26,8],[26,6,26,7],[27,8,28,8],[28,7,28,8],[28,6,28,7],[28,5,28,6],[27,5,28,5],[26,8,26,9],[28,9,28,10],[28,8,28,9],[26,10,26,11],[28,10,28,11],[28,11,28,12],[26,3,26,4],[28,3,28,4],[28,4,28,5],[26,11,27,11],[27,11,28,11],[26,12,26,13],[26,13,27,13],[27,13,28,13],[28,12,28,13],[26,3,27,3],[27,3,28,3],[16,5,17,5],[13,4,14,4],[14,4,15,4],[15,4,16,4],[16,4,17,4],[17,4,18,4],[18,4,19,4],[19,4,20,4],[20,3,20,4],[13,2,14,2],[14,2,15,2],[15,2,16,2],[16,2,17,2],[17,2,18,2],[18,2,19,2],[19,2,20,2],[14,15,15,15],[13,15,14,15],[12,15,13,15],[11,15,12,15],[10,15,11,15],[9,15,10,15],[8,15,9,15],[7,15,8,15],[6,15,7,15],[5,15,6,15],[4,15,5,15],[17,15,18,15],[18,15,19,15],[19,15,20,15],[20,15,21,15],[21,15,22,15],[22,15,23,15],[23,15,24,15],[24,15,25,15],[25,15,26,15],[26,15,27,15],[27,15,28,15],[28,14,28,15],[28,13,28,14],[28,2,28,3],[28,1,28,2],[27,1,28,1],[26,1,27,1],[25,1,26,1],[24,1,25,1],[22,1,23,1],[23,1,24,1],[21,1,22,1],[20,1,21,1],[19,1,20,1],[18,1,19,1],[17,1,18,1],[16,1,17,1],[15,1,16,1],[14,1,15,1],[13,1,14,1],[12,1,13,1],[11,1,12,1],[10,1,11,1],[9,1,10,1],[8,1,9,1],[7,1,8,1],[6,1,7,1],[5,1,6,1],[4,1,5,1],[4,1,4,2],[4,4,4,5],[4,6,4,7],[4,5,4,6],[4,7,4,8],[4,8,4,9],[4,9,4,10],[4,10,4,11],[4,11,4,12],[4,12,4,13],[4,13,4,14],[4,14,4,15]],"doors":[[15,7,16,7,1,1],[16,7,17,7,0,0],[26,5,26,6,1,1],[26,4,26,5,1,1],[26,9,26,10,1,1],[26,11,26,12,1,1],[13,2,13,3,1,1],[13,3,13,4,0,0],[15,15,16,15,1,1],[16,15,17,15,0,0],[4,3,4,4,0,0],[4,2,4,3,1,1]],"stairs":[]},"4:0":{"start":[15,13],"end":[15,7],"walls":[[12,7,13,7],[13,7,14,7],[14,7,15,7],[11,7,12,7],[10,7,11,7],[10,5,11,5],[11,5,12,5],[12,5,13,5],[13,5,14,5],[14,5,15,5],[15,5,16,5],[17,5,18,5],[18,5,19,5],[19,5,20,5],[18,7,19,7],[17,7,18,7],[19,7,20,7],[22,5,22,6],[21,5,22,5],[20,5,21,5],[20,7,21,7],[21,7,22,7],[22,6,22,7],[9,5,10,5],[9,5,9,6],[9,7,10,7],[9,6,9,7],[20,2,20,3],[26,5,27,5],[26,8,27,8],[26,7,26,8],[26,6,26,7],[27,8,28,8],[28,7,28,8],[28,6,28,7],[28,5,28,6],[27,5,28,5],[26,8,26,9],[28,9,28,10],[28,8,28,9],[26,10,26,11],[28,10,28,11],[28,11,28,12],[26,3,26,4],[28,3,28,4],[28,4,28,5],[26,11,27,11],[27,11,28,11],[26,12,26,13],[26,13,27,13],[27,13,28,13],[28,12,28,13],[26,3,27,3],[27,3,28,3],[16,5,17,5],[13,4,14,4],[14,4,15,4],[15,4,16,4],[16,4,17,4],[17,4,18,4],[18,4,19,4],[19,4,20,4],[20,3,20,4],[13,2,14,2],[14,2,15,2],[15,2,16,2],[16,2,17,2],[17,2,18,2],[18,2,19,2],[19,2,20,2],[14,15,15,15],[13,15,14,15],[12,15,13,15],[11,15,12,15],[10,15,11,15],[9,15,10,15],[8,15,9,15],[7,15,8,15],[6,15,7,15],[5,15,6,15],[4,15,5,15],[17,15,18,15],[18,15,19,15],[19,15,20,15],[20,15,21,15],[21,15,22,15],[22,15,23,15],[23,15,24,15],[24,15,25,15],[25,15,26,15],[26,15,27,15],[27,15,28,15],[28,14,28,15],[28,13,28,14],[28,2,28,3],[28,1,28,2],[27,1,28,1],[26,1,27,1],[25,1,26,1],[24,1,25,1],[22,1,23,1],[23,1,24,1],[21,1,22,1],[20,1,21,1],[19,1,20,1],[18,1,19,1],[17,1,18,1],[16,1,17,1],[15,1,16,1],[14,1,15,1],[13,1,14,1],[12,1,13,1],[11,1,12,1],[10,1,11,1],[9,1,10,1],[8,1,9,1],[7,1,8,1],[6,1,7,1],[5,1,6,1],[4,1,5,1],[4,1,4,2],[4,4,4,5],[4,6,4,7],[4,5,4,6],[4,7,4,8],[4,8,4,9],[4,9,4,10],[4,10,4,11],[4,11,4,12],[4,12,4,13],[4,13,4,14],[4,14,4,15]],"doors":[[15,7,16,7,1,1],[16,7,17,7,0,0],[26,5,26,6,1,1],[26,4,26,5,1,1],[26,9,26,10,1,1],[26,11,26,12,1,1],[13,2,13,3,1,1],[13,3,13,4,0,0],[15,15,16,15,1,1],[16,15,17,15,0,0],[4,3,4,4,0,0],[4,2,4,3,1,1]],"stairs":[]},"4:1":{"start":[17,12],"end":[16,6],"walls":[[16,11,17,11],[19,11,20,11],[19,10,19,11],[20,10,21,10],[19,10,20,10],[21,11,22,11],[21,10,22,10],[20,11,21,11],[22,10,22,11],[24,11,25,11],[16,10,16,11],[16,9,16,10],[15,9,16,9],[14,10,14,11],[14,9,14,10],[12,9,13,9],[12,9,12,10],[12,10,12,11],[12,11,13,11],[13,11,14,11],[14,11,15,11],[15,11,16,11],[11,9,12,9],[10,9,10,10],[10,10,10,11],[11,11,12,11],[10,11,11,11],[9,9,10,9],[9,11,10,11],[8,11,9,11],[7,11,8,11],[8,10,8,11],[8,9,8,10],[6,9,6,10],[6,11,7,11],[5,11,6,11],[3,11,4,11],[6,10,6,11],[3,9,4,9],[4,9,5,9],[4,9,4,10],[4,11,5,11],[2,11,3,11],[2,10,2,11],[2,9,3,9],[2,9,2,10],[5,7,5,8],[15,8,16,8],[14,8,15,8],[13,7,13,8],[13,6,13,7],[13,6,14,6],[14,6,15,6],[15,6,16,6],[16,6,16,7],[16,7,16,8],[12,8,13,8],[11,7,11,8],[11,6,11,7],[11,6,12,6],[12,6,13,6],[10,6,11,6],[9,6,10,6],[8,6,9,6],[7,6,8,6],[5,6,6,6],[6,6,7,6],[5,6,5,7],[10,8,11,8],[8,8,9,8],[9,7,9,8],[9,6,9,7],[6,8,7,8],[7,7,7,8],[7,6,7,7],[4,6,5,6],[2,6,3,6],[3,6,4,6],[2,6,2,7],[2,7,2,8],[2,8,2,9],[6,9,7,9],[16,6,17,6],[18,6,19,6],[17,6,18,6],[19,6,20,6],[21,6,22,6],[20,6,21,6],[22,6,23,6],[23,6,24,6],[25,6,26,6],[24,6,25,6],[26,6,27,6],[27,6,28,6],[28,6,29,6],[29,6,30,6],[30,6,31,6],[31,6,32,6],[32,6,33,6],[33,6,34,6],[18,6,18,7],[18,7,18,8],[19,8,20,8],[22,8,23,8],[21,6,21,7],[21,7,22,7],[20,7,21,7],[19,7,20,7],[18,7,19,7],[25,10,25,11],[25,9,25,10],[23,7,23,8],[23,6,23,7],[22,7,23,7],[20,8,21,8],[25,6,25,7],[25,7,25,8],[25,8,26,8],[27,7,27,8],[27,6,27,7],[25,9,26,9],[25,11,26,11],[26,11,27,11],[27,10,27,11],[27,9,28,9],[27,9,27,10],[27,11,28,11],[28,11,29,11],[29,10,29,11],[29,9,29,10],[29,11,30,11],[30,11,31,11],[31,10,31,11],[31,9,31,10],[29,9,30,9],[31,11,32,11],[32,11,33,11],[33,10,33,11],[33,9,33,10],[31,9,32,9],[33,11,34,11],[34,11,35,11],[33,9,34,9],[35,10,35,11],[35,9,35,10],[35,8,35,9],[34,6,35,6],[35,7,35,8],[35,6,35,7],[27,8,28,8],[29,8,30,8],[29,7,29,8],[29,6,29,7],[31,7,31,8],[31,6,31,7],[31,8,32,8],[33,7,33,8],[33,6,33,7],[33,8,34,8]],"doors":[[17,11,18,11,1,1],[18,11,19,11,0,0],[22,11,23,11,1,1],[23,11,24,11,0,0],[14,9,15,9,1,0],[13,8,14,8,0,0],[11,8,12,8,0,0],[9,8,10,8,0,0],[7,8,8,8,0,0],[5,8,6,8,0,0],[5,8,5,9,1,0],[5,9,6,9,0,1],[4,10,4,11,0,1],[7,9,8,9,0,1],[8,9,9,9,1,0],[13,9,14,9,0,1],[10,9,11,9,1,0],[18,8,19,8,1,1],[21,8,22,8,1,1],[26,8,27,8,1,1],[28,8,29,8,1,1],[30,8,31,8,1,1],[32,8,33,8,1,1],[34,8,35,8,1,1],[34,9,35,9,0,1],[32,9,33,9,0,1],[30,9,31,9,0,1],[28,9,29,9,0,1],[26,9,27,9,0,1]],"stairs":[[16,7],[16,6],[17,6],[24,7],[24,6],[23,6]]},"4:2":{"start":[17,8],"end":[9,9],"walls":[[16,11,17,11],[24,11,25,11],[16,10,16,11],[16,9,16,10],[15,9,16,9],[12,11,13,11],[13,11,14,11],[14,11,15,11],[15,11,16,11],[11,9,12,9],[11,11,12,11],[10,11,11,11],[9,9,10,9],[9,11,10,11],[8,11,9,11],[7,11,8,11],[6,11,7,11],[5,11,6,11],[3,11,4,11],[4,11,5,11],[14,8,15,8],[13,6,14,6],[14,6,15,6],[15,6,16,6],[16,6,16,7],[16,7,16,8],[12,8,13,8],[11,6,12,6],[12,6,13,6],[10,6,11,6],[9,6,10,6],[8,6,9,6],[7,6,8,6],[5,6,6,6],[6,6,7,6],[10,8,11,8],[8,8,9,8],[4,6,5,6],[3,6,4,6],[16,6,17,6],[18,6,19,6],[17,6,18,6],[19,6,20,6],[21,6,22,6],[20,6,21,6],[22,6,23,6],[23,6,24,6],[25,6,26,6],[24,6,25,6],[27,6,28,6],[28,6,29,6],[29,6,30,6],[30,6,31,6],[31,6,32,6],[32,6,33,6],[33,6,34,6],[18,6,18,7],[18,7,18,8],[19,8,20,8],[22,8,23,8],[21,7,22,7],[20,7,21,7],[19,7,20,7],[18,7,19,7],[25,10,25,11],[25,9,25,10],[23,7,23,8],[23,6,23,7],[22,7,23,7],[20,8,21,8],[25,6,25,7],[25,7,25,8],[27,6,27,7],[25,9,26,9],[25,11,26,11],[26,11,27,11],[27,9,28,9],[27,11,28,11],[28,11,29,11],[29,10,29,11],[29,9,29,10],[29,11,30,11],[30,11,31,11],[31,10,31,11],[31,9,31,10],[29,9,30,9],[31,11,32,11],[32,11,33,11],[33,10,33,11],[33,9,33,10],[31,9,32,9],[33,11,34,11],[34,11,35,11],[35,10,35,11],[35,9,35,10],[35,8,35,9],[34,6,35,6],[35,7,35,8],[35,6,35,7],[27,8,28,8],[29,7,29,8],[29,6,29,7],[31,7,31,8],[31,6,31,7],[33,7,33,8],[33,6,33,7],[17,11,18,11],[18,11,19,11],[18,11,18,12],[18,12,19,12],[19,12,20,12],[21,12,22,12],[20,12,21,12],[22,12,23,12],[23,11,23,12],[23,11,24,11],[22,11,23,11],[21,11,22,11],[19,11,20,11],[21,8,22,8],[26,8,27,8],[26,9,27,9],[29,8,30,8],[32,8,33,8],[28,8,29,8],[7,9,8,9],[14,7,14,8],[14,6,14,7],[12,6,12,7],[12,7,12,8],[10,7,10,8],[10,6,10,7],[8,7,8,8],[8,6,8,7],[6,8,7,8],[3,8,4,8],[3,7,3,8],[3,6,3,7],[5,7,5,8],[5,6,5,7],[5,8,6,8],[4,9,4,10],[4,10,4,11],[3,8,3,9],[3,9,3,10],[3,10,3,11],[5,9,6,9],[11,9,11,10],[11,10,11,11],[9,10,9,11],[9,9,9,10],[7,9,7,10],[7,10,7,11],[6,9,7,9],[14,9,15,9],[13,9,13,10],[13,10,13,11]],"doors":[[18,8,19,8,1,1],[4,8,5,8,0,0],[4,8,4,9,1,0],[4,9,5,9,0,1],[7,8,8,8,1,1],[9,8,10,8,1,1],[11,8,12,8,1,1],[13,8,14,8,1,1],[15,8,16,8,0,0],[13,9,14,9,0,1],[12,9,13,9,1,0],[10,9,11,9,0,1],[8,9,9,9,0,1],[26,6,27,6,1,1],[27,7,27,8,1,1],[28,9,29,9,1,0],[30,9,31,9,0,1],[30,8,31,8,1,1],[31,8,32,8,1,1],[32,9,33,9,0,1],[33,8,33,9,1,1],[25,8,26,8,0,0]],"stairs":[[16,6],[17,6],[24,6],[23,6],[17,7],[23,7],[26,5],[27,5],[28,5],[29,5],[30,5],[31,5]]}}
        refreshMenu();

        let lines = [];

        let endPoint = [];
        let startPoint = [];
        let paths = [] //[[startPoint]];
        let neonPathIndex = 0;

        let walls = [];
        let stairs = [];
        let doors = [];
        let selectedSprite = "start";

        let mx, my, blockx, blocky;
        canvas.addEventListener("mousemove", (e) => {
            mx = e.clientX - canvas.getBoundingClientRect().left;
            my = e.clientY - canvas.getBoundingClientRect().top;
            blockx = mx - (mx % cell);
            blocky = my - (my % cell);
        })
        canvas.addEventListener("click", () => {
            switch (selectedSprite) {
                case "wall":
                    const wallPos = getWallPos()
                    let overlap = false;
                    const wallsClone = [...walls];
                    for (let wi in wallsClone) {
                        const w = walls[wi];
                        if (
                            w[0] == wallPos[0] && w[1] == wallPos[1]
                            &&
                            w[2] == wallPos[2] && w[3] == wallPos[3]
                        ) {
                            overlap = true;
                            walls = walls.filter((_, i) => i != wi);
                            break;
                        }
                    }
                    if (!overlap) {
                        walls.push(wallPos);
                    }
                    break;
                case "stair":
                    const stairPos = [blockx / cell, blocky / cell];
                    let overlap_ = false;
                    const stairsClone = [...stairs];
                    for (let si in stairsClone) {
                        const s = stairs[si];
                        if (s[0] == stairPos[0] && s[1] == stairPos[1]) {
                            overlap_ = true;
                            stairs = stairs.filter((_, i) => i != si);
                            break;
                        }
                    }
                    if (!overlap_) {
                        stairs.push(stairPos);
                    }
                    break;
                case "door":
                    const doorPos = getWallPos();
                    let overlap__ = false;
                    const doorsClone = [...doors];
                    for (let di in doorsClone) {
                        const d = doors[di];
                        if (
                            d[0] == doorPos[0] && d[1] == doorPos[1]
                            &&
                            d[2] == doorPos[2] && d[3] == doorPos[3]
                        ) {
                            overlap__ = true;
                            doors = doors.filter((_, i) => i != di);
                            break;
                        }
                    }
                    if (!overlap__) {
                        let doorconfig = prompt("Door configuration [0-1|0-1]: ");
                        const fixedSide = Number(doorconfig[0]);
                        const openSide = Number(doorconfig[1]);
                        if (![0, 1].includes(fixedSide) || ![0, 1].includes(openSide)) break
                        doors.push([...doorPos, fixedSide, openSide]);
                    }
                    break;
                case "start":
                    startPoint = [blockx / cell, blocky / cell]
                    break;
                case "end":
                    endPoint = [blockx / cell, blocky / cell]
                    break;
            }
        })

        document.getElementById("map").addEventListener("change", (e) => {
            document.querySelector("h1").textContent = e.target.value;
            const selectedMap = savedmaps[e.target.value];
            paths = [];
            if (e.target.value == '') {
                endPoint = [];
                startPoint = [];
                walls = [];
                doors = [];
                stairs = [];
                return;
            }
            endPoint = selectedMap.end;
            startPoint = selectedMap.start;
            walls = selectedMap.walls;
            doors = selectedMap.doors;
            stairs = selectedMap.stairs;
        })

        document.querySelectorAll("input[name='selected-spr']").forEach(el => {
            el.addEventListener("change", (e) => {
                if (e.target.checked) {
                    selectedSprite = e.target.parentElement.textContent.trim().toLowerCase();
                }
            })
        })

        setInterval(update, 1000 / fps);


        function mapShift() {
            const shiftx = document.getElementById("shiftx");
            const shifty = document.getElementById("shifty");
            const xval = Number(shiftx.value) || 0;
            const yval = Number(shifty.value) || 0;

            endPoint = [endPoint[0] + xval, endPoint[1] + yval];
            startPoint = [startPoint[0] + xval, startPoint[1] + yval];
            for (let o of walls) {
                o[0] += xval;
                o[1] += yval;
                o[2] += xval;
                o[3] += yval;
            }
            for (let o of doors) {
                o[0] += xval;
                o[1] += yval;
                o[2] += xval;
                o[3] += yval;
            }
            for (let o of stairs) {
                o[0] += xval;
                o[1] += yval;
            }

            shiftx.value = 0;
            shifty.value = 0;
        }

        function saveMap() {
            const newMap = {
                "start": startPoint,
                "end": endPoint,
                "walls": walls,
                "doors": doors,
                "stairs": stairs
            }
            savedmaps[prompt("Map title: ")] = newMap;
            localStorage.setItem(
                "Guide-maps",
                JSON.stringify(savedmaps)
            );
            document.querySelector("p").textContent = JSON.stringify(newMap);
        }

        function removePath(pathName) {
            let cleaner = {};
            for (let k in savedmaps) {
                if (k == pathName) continue;
                cleaner[k] = savedmaps[k];
            }
            savedmaps = cleaner;

            localStorage.setItem(
                "Guide-maps",
                JSON.stringify(savedmaps)
            );
        }

        function getWallPos() {
            // drawing wall
            const t = distance(mx, my, blockx + cell / 2, blocky);
            const r = distance(mx, my, blockx + cell, blocky + cell / 2);
            const b = distance(mx, my, blockx + cell / 2, blocky + cell);
            const l = distance(mx, my, blockx, blocky + cell / 2);

            let wallPos = [];
            const wallx = blockx / cell;
            const wally = blocky / cell;
            switch (Math.min(t, r, b, l)) {
                case t:
                    wallPos = [wallx, wally, wallx + 1, wally];
                    break;
                case r:
                    wallPos = [wallx + 1, wally, wallx + 1, wally + 1];
                    break;
                case b:
                    wallPos = [wallx, wally + 1, wallx + 1, wally + 1];
                    break;
                case l:
                    wallPos = [wallx, wally, wallx, wally + 1];
                    break;
            }
            return wallPos;
        }

        function startSearch() {
            if (endPoint.length == 0 || startPoint.length == 0) {
                return
            }
            paths = findPath([[startPoint]]);
        }

        function findPath(paths) {
            // path finding
            let newPaths = [];
            let pathExists = false;
            for (let p of paths) {
                const head = p[p.length - 1];
                let heads = [
                    [head[0] - 1, head[1]],
                    [head[0] + 1, head[1]],
                    [head[0], head[1] + 1],
                    [head[0], head[1] - 1]
                ];
                // wall collision
                let x, y;
                if (heads[1] != undefined) {
                    x = heads[1][0]
                    y = heads[1][1]
                    for (let w of walls) {
                        if (x == w[0] && y == w[1] && x == w[2] && y + 1 == w[3]) {
                            delete heads[1]
                            break
                        }
                    }
                } if (heads[0] != undefined) {
                    x = heads[0][0] + 1;
                    y = heads[0][1]
                    for (let w of walls) {
                        if (x == w[0] && y == w[1] && x == w[2] && y + 1 == w[3]) {
                            delete heads[0]
                            break
                        }
                    }
                } if (heads[3] != undefined) {
                    x = heads[3][0]
                    y = heads[3][1] + 1;
                    for (let w of walls) {
                        if (x == w[0] && y == w[1] && x + 1 == w[2] && y == w[3]) {
                            delete heads[3]
                            break
                        }
                    }
                } if (heads[2] != undefined) {
                    x = heads[2][0];
                    y = heads[2][1]
                    for (let w of walls) {
                        if (x == w[0] && y == w[1] && x + 1 == w[2] && y == w[3]) {
                            delete heads[2]
                            break
                        }
                    }
                }
                heads = heads.filter(h => h != undefined)

                // target collision
                let success = false;
                for (let i = 0; i < heads.length; i++) {
                    if (heads[i][0] == endPoint[0] && heads[i][1] == endPoint[1]) {
                        success = true;
                        if (pathExists) {
                            if (p.length < newPaths[0].length) {
                                newPaths = [p];
                            }
                        } else {
                            newPaths = [p];
                            pathExists = true;
                        }
                    }
                }
                if (pathExists) {
                    continue
                }

                // collision, bouncing
                for (let i = 0; i < heads.length; i++) {
                    if (
                        heads[i][0] < 0 || heads[i][0] > xmax
                        ||
                        heads[i][1] < 0 || heads[i][1] > ymax
                    ) {
                        delete heads[i];
                        continue;
                    }

                    let collided = false;
                    for (let p_ of paths) {
                        for (let point of p_) {
                            if (heads[i][0] == point[0] && heads[i][1] == point[1]) {
                                delete heads[i]
                                collided = true
                                break
                            }
                        }
                        if (collided) {
                            break
                        }
                    }
                    if (collided) {
                        continue
                    }
                    collided = false;
                    for (let p_ of newPaths) {
                        for (let point of p_) {
                            if (heads[i][0] == point[0] && heads[i][1] == point[1]) {
                                delete heads[i]
                                collided = true
                                break
                            }
                        }
                        if (collided) {
                            break
                        }
                    }
                    if (collided) {
                        continue
                    }
                }

                heads = heads.filter(h => h != undefined)
                for (let h of heads) {
                    newPaths.push([...p, h])
                }
            }
            // if paths != newpaths: stop recursion
            let areDifferent = false;
            if (paths.length == newPaths.length) {
                for (let i in paths) {
                    if (paths[i].length != newPaths[i].length) {
                        areDifferent = true;
                        break;
                    }
                    for (let j in paths[i]) {
                        for (let k in paths[i][j]) {
                            if (paths[i][j][k] != newPaths[i][j][k]) {
                                areDifferent = true;
                                break
                            }
                        }
                        if (areDifferent) break
                    }
                    if (areDifferent) break
                }
            } else {
                areDifferent = true;
            }

            if (areDifferent) {
                return findPath(newPaths);
            }
            return paths;
        }

        function update() {
            ctx.fillStyle = "black";
            ctx.fillRect(0, 0, xmax * cell, ymax * cell);
            // after refresh
            for (let i = (blockx / cell); i <= (blockx / cell) + 1; i++) {
                drawLine(i * cell, blocky - 1 * cell, i * cell, blocky + 2 * cell, "white", 1)
            }
            for (let i = (blocky / cell); i <= (blocky / cell) + 1; i++) {
                drawLine(blockx - 1 * cell, i * cell, blockx + 2 * cell, i * cell, "white", 1)
            }

            // for (let l of lines){
            //     drawLine(l[0], l[1], l[2], l[3]);
            // }
            if (paths.length) {
                drawPoints(paths[0]);
                drawTargetCircle()
            }

            for (let d of doors) {
                drawDoor(d[0], d[1], d[2], d[3], d[4], d[5]);
            }
            for (let s of stairs) {
                drawStair(s[0], s[1]);
            }
            for (let w of walls) {
                drawWall(w[0], w[1], w[2], w[3]);
            }

            if (startPoint.length) {
                ctx.fillStyle = "yellow";
                ctx.fillRect(startPoint[0] * cell + cell / 4, startPoint[1] * cell + cell / 4, cell / 2, cell / 2);
            }
            if (endPoint.length) {
                ctx.fillStyle = "white";
                ctx.fillRect(endPoint[0] * cell + cell / 4, endPoint[1] * cell + cell / 4, cell / 2, cell / 2);
            }
            if (["wall", "door"].includes(selectedSprite)) {
                drawWallZone()
            }


        }

        function drawLine(x1, y1, x2, y2, c = "white", w = 1) {
            ctx.strokeStyle = c;
            ctx.lineWidth = w;
            // Define a new Path:
            ctx.beginPath();

            // Define a start Point
            ctx.moveTo(x1, y1);

            // Define an end Point
            ctx.lineTo(x2, y2);

            // Stroke it (Do the Drawing)
            ctx.stroke();
        }

        function drawWall(x1, y1, x2, y2) {
            drawLine(x1 * cell, y1 * cell, x2 * cell, y2 * cell, "cyan", 4);
        }

        function drawDoor(x1, y1, x2, y2, fixedSide, openSide) {
            const doorx = Math.max(x1 * fixedSide, Math.abs(x2 * (fixedSide - 1)));
            const doory = Math.max(y1 * fixedSide, Math.abs(y2 * (fixedSide - 1)));
            const edgex = doorx == x1 ? x2 : x1;
            const edgey = doory == y1 ? y2 : y1;
            const offsetAngle = Math.atan2(doorx - edgex, doory - edgey) + ((doory == edgey) ? 1 : -1) * 0.5 * Math.PI;
            if ((neonPathIndex % 8) > 4) {
                drawLine(
                    doorx * cell,
                    doory * cell,
                    edgex * cell,
                    edgey * cell,
                    "palegreen",
                    3
                );
            } else {
                drawLine(
                    doorx * cell,
                    doory * cell,
                    doorx * cell + (Math.cos(((30 - openSide * 60) / 180) * Math.PI + offsetAngle) * cell),
                    doory * cell + (Math.sin(((30 - openSide * 60) / 180) * Math.PI + offsetAngle) * cell),
                    "palegreen",
                    3
                );
                ctx.lineWidth = 1;
                ctx.strokeStyle = "white";
                ctx.beginPath();
                ctx.arc(doorx * cell, doory * cell, cell, offsetAngle - openSide * (1 / 6) * Math.PI, offsetAngle + (1 * (Math.abs(openSide - 1)) / 6) * Math.PI);
                ctx.stroke();

            }
        }

        function drawStair(x, y) {
            for (let i = 0; i <= 4; i++) {
                drawLine(x * cell, y * cell + (i * cell / 4), (x + 1) * cell, y * cell + (i * cell / 4), "white", 1);
            }
        }

        function drawWallZone() {
            let [x1, y1, x2, y2] = [...getWallPos()];
            x1 *= cell;
            y1 *= cell;
            x2 *= cell;
            y2 *= cell;
            drawLine(x1 - 4, y1 - 4, x2 + 4, y1 - 4, "red");
            drawLine(x1 - 4, y2 + 4, x2 + 4, y2 + 4, "red");
            drawLine(x1 - 4, y1 - 4, x1 - 4, y2 + 4, "red");
            drawLine(x2 + 4, y1 - 4, x2 + 4, y2 + 4, "red");
        }

        function drawTargetCircle() {
            const ratio = neonPathIndex / paths[0].length;
            ctx.lineWidth = 1;
            ctx.strokeStyle = "white";
            ctx.beginPath();
            ctx.arc(endPoint[0] * cell + cell / 2, endPoint[1] * cell + cell / 2, 1.5 * cell * ratio, 0, 2 * Math.PI);
            // ctx.rect((endPoint[0]*cell + cell / 2) - (cell * 2 * ratio) / 2, (endPoint[1]*cell + cell / 2) - (cell * 2 * ratio) / 2, cell * 2 * ratio, cell * 2 * ratio)
            ctx.stroke();
        }

        function drawPoints(points) {
            neonPathIndex += 0.5
            neonPathIndex %= paths[0].length;

            ctx.fillStyle = "red";
            for (let i in points) {
                const [x, y] = points[i];
                if (i == Math.floor(neonPathIndex)) {
                    ctx.fillRect(x * cell, y * cell, cell, cell);
                } else {
                    ctx.fillRect(x * cell + (cell / 3), y * cell + (cell / 3), cell / 3, cell / 3);
                }
            }
        }

        function distance(x1, y1, x2, y2) {
            return Math.sqrt(Math.pow(x1 - x2, 2) + Math.pow(y1 - y2, 2));
        }

        function refreshMenu() {
            let newHTML = '<option value=\'\'>Blank</option>';
            for (let mapTitle of Object.keys(savedmaps)) {
                newHTML += `<option>${mapTitle}</option>`
            }
            document.getElementById("map").innerHTML = newHTML;
        }

    </script>
</body>

</html>